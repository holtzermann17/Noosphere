#!/usr/bin/perl

my $text=$ARGV[0];

while ($text=~/\\PM\w+\{([^\}]*)\$.+?\$([^\}]*)\}\{.+?\}/s) {
  if ($1 && $2) {
    $text=~s/(\\PM\w+\{)([^\}]*)(\$.+?\$)([^\}]*\})(\{.+?\})/$1$2\}$5$3$1$4$5/s;
  } else {
    if ($2) {
      $text=~s/(\\PM\w+\{)([^\}]*)(\$.+?\$)([^\}]*\})(\{.+?\})/$3$1$4$5/s;
	} 
	elsif ($1) {
      $text=~s/(\\PM\w+\{)([^\}]*)(\$.+?\$)([^\}]*\})(\{.+?\})/$1$2\}$5$3/s;
	} 
	else {
      $text=~s/(\\PM\w+\{)([^\}]*)(\$.+?\$)([^\}]*\})(\{.+?\})/$3/s;
	}
  }
}

print "----------------------------------------------\n$text\n";
